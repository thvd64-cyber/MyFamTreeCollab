// Haal data op of start met lege array
let stamboomData = JSON.parse(localStorage.getItem('stamboomData') || '[]'); // r.2

// Elementen ophalen
const form = document.getElementById('addPersonForm'); // r.5
const preview = document.getElementById('stamboomPreview'); // r.6

// Functie om unieke ID te genereren
function generateID() {
    return 'p' + Date.now(); // r.10
}

// Voeg persoon toe bij formulier submit
form.addEventListener('submit', function(e){
    e.preventDefault(); // voorkom standaard submit

    // Nieuw persoon-object met alle velden
    const person = {
        ID: generateID(), // unieke ID
        doopnaam: document.getElementById('doopnaam').value, // doopnaam
        roepnaam: document.getElementById('roepnaam').value, // roepnaam
        prefix: document.getElementById('prefix').value,     // bv van, de
        achternaam: document.getElementById('achternaam').value,
        geboorte: document.getElementById('geboorte').value,
        geslacht: document.getElementById('geslacht').value,
        ouderID: null,
        partnerID: null
    };

    // RootPerson check: eerste persoon in array
    if(stamboomData.length === 0){
        const rootPerson = person; // r.25
        stamboomData = [rootPerson]; // start array met root
    } else {
        stamboomData.push(person); // voeg extra persoon toe
    }

    // Opslaan in localStorage
    localStorage.setItem('stamboomData', JSON.stringify(stamboomData));

    // Preview updaten
    renderStamboom();

    // Formulier resetten
    form.reset();
});

// Render preview van stamboom
function renderStamboom(){
    preview.innerHTML = ''; // reset preview

    if(stamboomData.length === 0){
        preview.innerHTML = '<p>Geen leden toegevoegd. Voeg de eerste persoon toe.</p>';
        return;
    }

    stamboomData.forEach(p => {
        const div = document.createElement('div');
        div.className = 'node';

        // Bouw volledige naam
        let fullName = p.doopnaam; // doopnaam altijd zichtbaar
        if(p.roepnaam) fullName += ` (${p.roepnaam})`; // roepnaam optioneel
        if(p.prefix) fullName += ` ${p.prefix}`;       // prefix optioneel
        fullName += ` ${p.achternaam}`;              // achternaam
        if(p.geboorte) fullName += ` (${p.geboorte})`; // geboorte optioneel

        div.textContent = fullName; // tekst in preview div
        preview.appendChild(div);
    });
}

// Init render
renderStamboom();
